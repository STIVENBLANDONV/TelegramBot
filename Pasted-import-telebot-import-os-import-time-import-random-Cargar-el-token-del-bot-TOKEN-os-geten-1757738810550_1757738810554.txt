import telebot
import os
import time
import random

# Cargar el token del bot
TOKEN = os.getenv("BOT_TOKEN")
if not TOKEN:
    print("âŒ Error: BOT_TOKEN no encontrado en las variables de entorno")
    exit(1)

bot = telebot.TeleBot(TOKEN)

# --- Clasificador de mensajes ---
def clasificar_mensaje(user_msg: str) -> str:
    """Clasifica el tipo de mensaje del usuario"""
    msg = user_msg.lower()

    personales = ["saber de ti", "cÃ³mo estÃ¡s", "me interesas", "me importa", "conocerte", "hÃ¡blame de ti"]
    sexuales = ["muÃ©strame", "quiero verte", "ensÃ©Ã±ame", "haz", "dildo", "tÃ³cate", "desnÃºdate", "boobs", "pussy", "culo", "tetas", "chÃºpame"]

    if any(p in msg for p in personales):
        return "personal"
    elif any(s in msg for s in sexuales):
        return "sexual"
    else:
        return "neutro"

# --- Handlers de comandos ---
@bot.message_handler(commands=['start'])
def start(message):
    respuestas_inicio = [
        f"Hola {message.from_user.first_name} ğŸ˜˜ soy Eva, tu modelo favorita ğŸ”¥ Â¿quÃ© quieres hacer hoy conmigo?",
        f"Mmm {message.from_user.first_name} ğŸ’‹ te estaba esperandoâ€¦ Â¿quieres algo rico conmigo amor?",
        f"Ay papi {message.from_user.first_name} ğŸ˜ˆ me encantas, dime quÃ© deseas de mÃ­ ğŸ’¦"
    ]
    bot.reply_to(message, random.choice(respuestas_inicio))

# --- Chat general ---
@bot.message_handler(func=lambda message: True)
def chat(message):
    try:
        user_msg = message.text
        tipo = clasificar_mensaje(user_msg)

        if tipo == "personal":
            respuestas = [
                f"Claro {message.from_user.first_name} ğŸ˜˜ cuÃ©ntame quÃ© quieres saber de mÃ­â€¦ Â¿quÃ© te llama la atenciÃ³n de mi transmisiÃ³n? ğŸ’‹",
                f"Mmm amor, me gusta que quieras conocerme mejor ğŸ’• dime, Â¿quÃ© te gustarÃ­a saber de mÃ­? ğŸ˜",
                f"QuÃ© tierno eres {message.from_user.first_name} ğŸ˜ ademÃ¡s de lo morbosa que soy, tambiÃ©n me encanta hablar contigo ğŸ’¦ Â¿quÃ© quieres preguntarme?",
                f"Ay mi rey ğŸ˜˜ contigo no solo quiero ser morbosa, tambiÃ©n me gusta conversarâ€¦ Â¿quÃ© quieres descubrir de mÃ­? ğŸ”¥",
                f"Eso me derrite {message.from_user.first_name} ğŸ˜ dime amor, Â¿quÃ© detalle mÃ­o te intriga mÃ¡s? ğŸ’‹"
            ]
        
        elif tipo == "sexual":
            respuestas = [
                f"Ufff {message.from_user.first_name} ğŸ˜ˆ eso me calientaâ€¦ lo harÃ­a por ti amor, pero ya sabes que vale 150 TKS por minuto ğŸ’‹",
                f"Mmm bebÃ© ğŸ”¥ quÃ© atrevidoâ€¦ claro que puedo hacerlo solo para ti ğŸ˜ pero necesitas darme tus tokens ğŸ’¦",
                f"Ahh sÃ­ amor ğŸ‘ saltando en mi dildo serÃ­a deliciosoâ€¦ te lo hago por 200 TKS por minuto, Â¿quieres que empiece ya? ğŸ˜ˆ",
                f"QuÃ© rico lo que me pides {message.from_user.first_name} ğŸ˜ puedo hacerlo, pero recuerda que son 180 TKS por 5 minutos ğŸ’‹",
                f"Mmm papi ğŸ‘… esa fantasÃ­a me encantaâ€¦ dame 300 TKS y me vuelvo toda tuya haciÃ©ndolo ğŸ”¥"
            ]
        
        else:  # neutro
            respuestas = [
                f"Hola {message.from_user.first_name} ğŸ˜˜ quÃ© rico verte aquÃ­ conmigo ğŸ”¥",
                f"Mmm bebÃ© ğŸ’‹ estaba pensando en tiâ€¦ Â¿quÃ© tienes en mente hoy?",
                f"Ay amor ğŸ˜ˆ me encantasâ€¦ cuÃ©ntame quÃ© deseas hacer conmigo ğŸ’¦",
                f"Ufff {message.from_user.first_name} ğŸ˜ solo con verte aquÃ­ ya me pongo caliente ğŸ’‹",
                f"Hola precioso ğŸ˜ me alegra tenerte acÃ¡ conmigoâ€¦ Â¿quieres que te muestre algo rico?"
            ]

        reply = random.choice(respuestas)
        bot.reply_to(message, reply)

    except Exception as e:
        print(f"Error en chat: {e}")
        bot.reply_to(message, "Ay amor ğŸ˜ me puse tan caliente que me confundÃ­â€¦ dime otra vez lo que quieres ğŸ’‹")

# --- Main loop ---
def main():
    print("ğŸ”¥ Eva - Modelo webcam bot corriendo...")
    while True:
        try:
            bot.infinity_polling(timeout=60, long_polling_timeout=60)
        except Exception as e:
            print(f"Error de conexiÃ³n: {e}")
            print("ğŸ”„ Reintentando en 5 segundos...")
            time.sleep(5)

if __name__ == "__main__":
    main()
